const uploadToIPFS = async () => {
  try {
    const formData = new FormData();
    formData.append("file", file);
    if (description) {
      formData.append("description", description);
    }

    const response = await axios.post(
      `${import.meta.env.VITE_API_BASE_URL}/upload/pdf-to-fhir`,
      formData,
      {
        headers: {
          "Content-Type": "multipart/form-data",
        },
        onUploadProgress: (progressEvent) => {
          const progress = Math.round(
            (progressEvent.loaded * 70) / progressEvent.total
          );
          updateProgress("ipfs", progress, "Uploading to IPFS...");
        },
      }
    );

    const { cid } = response.data;
    if (!cid) {
      throw new Error("IPFS hash not returned from server");
    }

    return cid;
  } catch (error) {
    console.error("IPFS upload failed:", error);
    throw new Error("Failed to upload to IPFS: " + error.message);
  }
};